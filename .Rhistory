collapse = TRUE,
comment = "#>",
fig.width=4,
fig.height=2.5
)
devtools::load_all()
# install.packages(".", repos = NULL, type="source")
# library(anem)
library(magrittr)
library(sf)
library(tidyverse)
devtools::load_all("~/Projects/R_packages/anem")
Ksat <- 0.0001 # m/s
h0 <- 100 # resting hydraulic head, m
aquifer_porosity <- 0.4 # needed for some methods of calculating radius of influence
# pts_wgs <- sf::read_sf("../../../CNH/genevois/spatial/shp/manual/pts_text.shp") %>%
#   mutate(type=factor(sign(rate),levels=c(-1,0,1),labels=c("pumping","defunct","injection"))) %>%
#   mutate(rate=c(-0.03,0.01))
pts_wgs <- sf::read_sf("/Users/gopal/Projects/CNH/genevois/spatial/shp/stylized_aquifer/genevois_wells_stylized.shp") %>%
mutate(diam=RADUIS*2) %>% select(diam,well_group=CONCESSION) %>% group_by(well_group) %>%
mutate(rate=1/n())
pts_wgs
# boundaries_wgs <- sf::read_sf("../../../CNH/genevois/spatial/shp/manual/lines_text.shp")
boundaries_wgs <- sf::read_sf("/Users/gopal/Projects/CNH/genevois/spatial/shp/stylized_aquifer/genevois_bounds_stylized.shp")
boundaries_wgs
utm_zone <- longitude_to_utm_zone(mean(st_coordinates(pts_wgs)[,'X']))
utm_proj4 <- utm_zone_to_proj4(utm_zone)
pts_utm <- pts_wgs %>% sf::st_transform(utm_proj4)
boundaries_utm <- boundaries_wgs %>% sf::st_transform(utm_proj4)
ggplot() +
geom_sf(data=boundaries_utm, aes()) +
geom_sf(data=pts_utm, aes())
boundaries <- prep_bounds(boundaries_utm,get_rectangular = TRUE)
bounds_polygon <- boundaries %>% st_coordinates() %>% as_tibble() %>% select(-L1) %>% distinct() %>% st_as_sf(coords=c("X","Y")) %>%
summarize() %>% st_cast("POLYGON")
bounds_polygon <- boundaries %>%
summarize() %>% st_polygonize() %>% st_collection_extract("POLYGON")
wells <- prep_wells_sf(pts_utm) %>% st_intersection(bounds_polygon) %>% group_by() %>%
mutate(rate=-1e-1/n(),
rate=if_else(well_group=="COMMUNE",-2*rate,rate)) %>% group_by() %>%
mutate(roi=get_radius_of_influence(Ksat=Ksat,h=h0,t=3600*24*365*20,n=aquifer_porosity,method="aravin-numerov"))
ggplot() +
geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_sf(data=boundaries, aes(color=as.factor(bGroup))) +
geom_sf(data=wells, aes())
z0 <- 10
grid_bounds <- boundaries %>% st_coordinates() %>% as_tibble() %>%
summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds <- data.frame(xmin=276000,xmax=283500,ymin=5115000,ymax=5120000)
grid_pts_head <- with(grid_bounds,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
heads <- get_hydraulic_head(grid_pts_head,wells,h0=h0,Ksat=Ksat,z0=z0,aquifer_type="confined")
head_df <- grid_pts_head %>% bind_cols(head_m=heads)
ggplot(head_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_sf(data=wells, aes(size=abs(rate)),shape=16) +
geom_contour(aes(x,y,z=head_m),bins=15,color="gray",linetype="dashed")  +
coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax)) +
scale_size_continuous(limits=c(3,4)) +
scale_shape_manual(values=c(1,16),limits=c(3,4))
grid_pts_flowdir <- with(grid_bounds,crossing(x=seq(xmin,xmax,length.out=15),y=seq(ymin,ymax,length.out=10)))
flow_dir <- get_flowdir(grid_pts_flowdir,wells,h0=h0,Ksat=Ksat,z0=z0,aquifer_type="confined")
# the dx_norm and dy_norm are used to make the arrows visible in the plot that follows.
flow_dir_df <- grid_pts_flowdir %>% bind_cols(flow_dir) %>%
mutate(angle=atan(dy/dx),
mag=sqrt(dx^2+dy^2),
mag_norm=mag^(1/2)*3e3, # this scales the flow for the arrow plot
dx_norm=cos(angle)*sign(dx)*mag_norm,
dy_norm=sin(angle)*sign(dx)*mag_norm,
x2=x+dx_norm,
y2=y+dy_norm)
# plot the flow velocities
ggplot(flow_dir_df) +
geom_raster(aes(x,y,fill=mag_norm))  +
geom_sf(data=wells, aes(),size=3) +
coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax))
ggplot(head_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_point(data=wells, aes(x=x0,y=y0),shape=1,stroke=1) +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
geom_segment(data=flow_dir_df,
aes(x,y,xend=x2,yend=y2),
arrow = arrow(ends="last",type="closed",length=unit(1,"mm"))) +
coord_equal() +
# coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax),crs = st_crs(wells)) +
scale_shape_manual(values=c(1,16),limits=c(3,4)) #+ scale_size_continuous(limits=c(3,4))
z0 <- 10
grid_bounds <- boundaries %>% st_coordinates() %>% as_tibble() %>%
summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
# grid_bounds <- data.frame(xmin=276000,xmax=283500,ymin=5115000,ymax=5120000)
grid_pts_head <- with(grid_bounds,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
heads <- get_hydraulic_head(grid_pts_head,wells,h0=h0,Ksat=Ksat,z0=z0,aquifer_type="confined")
head_df <- grid_pts_head %>% bind_cols(head_m=heads)
ggplot(head_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_sf(data=wells, aes(size=abs(rate)),shape=16) +
geom_contour(aes(x,y,z=head_m),bins=15,color="gray",linetype="dashed")  +
coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax)) +
scale_size_continuous(limits=c(3,4)) +
scale_shape_manual(values=c(1,16),limits=c(3,4))
grid_pts_flowdir <- with(grid_bounds,crossing(x=seq(xmin,xmax,length.out=15),y=seq(ymin,ymax,length.out=10)))
flow_dir <- get_flowdir(grid_pts_flowdir,wells,h0=h0,Ksat=Ksat,z0=z0,aquifer_type="confined")
# the dx_norm and dy_norm are used to make the arrows visible in the plot that follows.
flow_dir_df <- grid_pts_flowdir %>% bind_cols(flow_dir) %>%
mutate(angle=atan(dy/dx),
mag=sqrt(dx^2+dy^2),
mag_norm=mag^(1/2)*3e3, # this scales the flow for the arrow plot
dx_norm=cos(angle)*sign(dx)*mag_norm,
dy_norm=sin(angle)*sign(dx)*mag_norm,
x2=x+dx_norm,
y2=y+dy_norm)
# plot the flow velocities
ggplot(flow_dir_df) +
geom_raster(aes(x,y,fill=mag_norm))  +
geom_sf(data=wells, aes(),size=3) +
coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax))
ggplot(head_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_point(data=wells, aes(x=x0,y=y0),shape=1,stroke=1) +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
geom_segment(data=flow_dir_df,
aes(x,y,xend=x2,yend=y2),
arrow = arrow(ends="last",type="closed",length=unit(1,"mm"))) +
coord_equal() +
# coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax),crs = st_crs(wells)) +
scale_shape_manual(values=c(1,16),limits=c(3,4)) #+ scale_size_continuous(limits=c(3,4))
well_images <- generate_image_wells(wells,boundaries,num_levels=3) %>%
mutate(roi=get_radius_of_influence(Ksat=Ksat,h=h0,t=3600*24*365*100,n=aquifer_porosity,method="aravin-numerov"))
well_roi <- gen_circles(well_images %>% rename(r=roi,x=x0,y=y0))
ggplot()  +
geom_sf(data=boundaries, aes()) +
geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images,aes(x0,y0),alpha=0.5) +
# geom_polygon(data=well_roi,aes(x,y,group=id),alpha=0.3,color="black")
geom_polygon(data=well_roi,aes(x,y,group=id),alpha=0.01)
well_images <- well_images %>% filter(max_mirror_dist<roi)
well_roi <- gen_circles(well_images %>% rename(r=roi,x=x0,y=y0))
ggplot()  +
geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray")+
geom_sf(data=boundaries, aes(color=as.factor(bID)),size=1) +
geom_polygon(data=well_roi,aes(x,y,group=id),alpha=0.1,color="black") +
geom_sf(data=boundaries, aes(color=as.factor(bID)),size=1) +
geom_point(data=well_images,aes(x0,y0,fill=rate),alpha=0.5,size=3,shape=21) +
scale_fill_gradient2("Pumping rate",low="blue",mid="gray",high="red") +
scale_color_discrete("Boundary")
# NOTE: THIS FUNCTION DOES NOT SEEM TO BE WORKING AS EXPECTED!
gg_bounds_behavior<- plot_bounds_behavior(wells,well_images,boundaries,h0=100,Ksat=0.00001,aquifer_type="unconfined")
gridExtra::grid.arrange(gg_bounds_behavior$p_h,gg_bounds_behavior$p_f,nrow=1)
# ggplot(gg_bounds_behavior$bounds_behavior,aes(x,y)) + geom_raster(aes(fill=head)) + geom_contour(aes(z=head))
# grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
#   summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5113000,ymax=5120000)
grid_pts_head_unconf <- with(grid_bounds_unconf,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
heads_unconf <- get_hydraulic_head(grid_pts_head_unconf,well_images,h0=100,Ksat=0.00001,aquifer_type="unconfined")
head_unconf_df <- grid_pts_head_unconf %>% bind_cols(head_m=heads_unconf)
ggplot(head_unconf_df %>% mutate(influenced_by_wells=head_m!=100)) +
geom_raster(aes(x,y,fill=influenced_by_wells)) +
geom_sf(data=boundaries, aes()) +
ggtitle("Region of well influence")
ggplot(head_unconf_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
geom_sf(data=boundaries, aes()) +
# geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
# geom_sf(data=pts_utm, aes(size=abs(rate),shape=type)) +
coord_sf(xlim=c(grid_bounds_unconf$xmin,grid_bounds_unconf$xmax),ylim=c(grid_bounds_unconf$ymin,grid_bounds_unconf$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4))
ggplot(head_unconf_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
geom_sf(data=boundaries, aes()) +
# geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
# geom_sf(data=pts_utm, aes(size=abs(rate),shape=type)) +
coord_sf(xlim=c(grid_bounds_unconf$xmin,grid_bounds_unconf$xmax),ylim=c(grid_bounds_unconf$ymin,grid_bounds_unconf$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4))
grid_pts_flowdir_unconf <- with(grid_bounds_unconf,crossing(x=seq(xmin,xmax,length.out=30),y=seq(ymin,ymax,length.out=20)))
flow_dir_unconf <- get_flowdir(grid_pts_flowdir_unconf,well_images,h0=100,Ksat=0.00001,aquifer_type="unconfined")
flow_dir_unconf <- get_flowdir(grid_pts_flowdir_unconf,well_images,h0=100,Ksat=0.00001,aquifer_type="unconfined")
# the dx_norm and dy_norm are used to make the arrows visible in the plot that follows.
flow_dir_unconf_df <- grid_pts_flowdir_unconf %>% bind_cols(flow_dir_unconf) %>%
mutate(angle=atan(dy/dx),
mag=sqrt(dx^2+dy^2),
mag_norm=mag^(1/3)*1e3,
dx_norm=cos(angle)*sign(dx)*mag_norm,
dy_norm=sin(angle)*sign(dx)*mag_norm,
x2=x+dx_norm,
y2=y+dy_norm)
# plot the flow velocities
ggplot(flow_dir_unconf_df) +
geom_raster(aes(x,y,fill=mag_norm))  +
geom_sf(data=boundaries, aes()) +
geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
coord_sf(xlim=c(grid_bounds_unconf$xmin,grid_bounds_unconf$xmax),
ylim=c(grid_bounds_unconf$ymin,grid_bounds_unconf$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4))
ggplot(head_unconf_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_sf(data=boundaries, aes()) +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
# geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
geom_segment(data=flow_dir_unconf_df,
aes(x,y,xend=x2,yend=y2),arrow = arrow(ends="last",type="closed",length=unit(1,"mm"))) +
coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4)) #+ scale_size_continuous(limits=c(3,4))
# the dx_norm and dy_norm are used to make the arrows visible in the plot that follows.
flow_dir_unconf_df <- grid_pts_flowdir_unconf %>% bind_cols(flow_dir_unconf) %>%
mutate(angle=atan(dy/dx),
mag=sqrt(dx^2+dy^2),
mag_norm=mag^(1/3)*5e3,
dx_norm=cos(angle)*sign(dx)*mag_norm,
dy_norm=sin(angle)*sign(dx)*mag_norm,
x2=x+dx_norm,
y2=y+dy_norm)
ggplot(head_unconf_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_sf(data=boundaries, aes()) +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
# geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
geom_segment(data=flow_dir_unconf_df,
aes(x,y,xend=x2,yend=y2),arrow = arrow(ends="last",type="closed",length=unit(1,"mm"))) +
coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4)) #+ scale_size_continuous(limits=c(3,4))
# the dx_norm and dy_norm are used to make the arrows visible in the plot that follows.
flow_dir_unconf_df <- grid_pts_flowdir_unconf %>% bind_cols(flow_dir_unconf) %>%
mutate(angle=atan(dy/dx),
mag=sqrt(dx^2+dy^2),
mag_norm=mag^(1/3)*2e3,
dx_norm=cos(angle)*sign(dx)*mag_norm,
dy_norm=sin(angle)*sign(dx)*mag_norm,
x2=x+dx_norm,
y2=y+dy_norm)
ggplot(head_unconf_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_sf(data=boundaries, aes()) +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
# geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
geom_segment(data=flow_dir_unconf_df,
aes(x,y,xend=x2,yend=y2),arrow = arrow(ends="last",type="closed",length=unit(1,"mm"))) +
coord_sf(xlim=c(grid_bounds$xmin,grid_bounds$xmax),ylim=c(grid_bounds$ymin,grid_bounds$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4)) #+ scale_size_continuous(limits=c(3,4))
# grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
#   summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5112500,ymax=5120000)
head_unconf_df <- grid_pts_head_unconf %>% bind_cols(head_m=heads_unconf)
ggplot(head_unconf_df %>% mutate(influenced_by_wells=head_m!=100)) +
geom_raster(aes(x,y,fill=influenced_by_wells)) +
geom_sf(data=boundaries, aes()) +
ggtitle("Region of well influence")
ggplot(head_unconf_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
geom_sf(data=boundaries, aes()) +
# geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
# geom_sf(data=pts_utm, aes(size=abs(rate),shape=type)) +
coord_sf(xlim=c(grid_bounds_unconf$xmin,grid_bounds_unconf$xmax),ylim=c(grid_bounds_unconf$ymin,grid_bounds_unconf$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4))
# grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
#   summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5112000,ymax=5120000)
grid_pts_head_unconf <- with(grid_bounds_unconf,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
heads_unconf <- get_hydraulic_head(grid_pts_head_unconf,well_images,h0=100,Ksat=0.00001,aquifer_type="unconfined")
ggplot(head_unconf_df %>% mutate(influenced_by_wells=head_m!=100)) +
geom_raster(aes(x,y,fill=influenced_by_wells)) +
geom_sf(data=boundaries, aes()) +
ggtitle("Region of well influence")
# grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
#   summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5110000,ymax=5120000)
# grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
#   summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5110000,ymax=5120000)
grid_pts_head_unconf <- with(grid_bounds_unconf,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
heads_unconf <- get_hydraulic_head(grid_pts_head_unconf,well_images,h0=100,Ksat=0.00001,aquifer_type="unconfined")
ggplot(head_unconf_df %>% mutate(influenced_by_wells=head_m!=100)) +
geom_raster(aes(x,y,fill=influenced_by_wells)) +
geom_sf(data=boundaries, aes()) +
ggtitle("Region of well influence")
# grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
#   summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5100000,ymax=5120000)
grid_pts_head_unconf <- with(grid_bounds_unconf,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
head_unconf_df <- grid_pts_head_unconf %>% bind_cols(head_m=heads_unconf)
ggplot(head_unconf_df %>% mutate(influenced_by_wells=head_m!=100)) +
geom_raster(aes(x,y,fill=influenced_by_wells)) +
geom_sf(data=boundaries, aes()) +
ggtitle("Region of well influence")
# grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
#   summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5108000,ymax=5120000)
grid_pts_head_unconf <- with(grid_bounds_unconf,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
head_unconf_df <- grid_pts_head_unconf %>% bind_cols(head_m=heads_unconf)
ggplot(head_unconf_df %>% mutate(influenced_by_wells=head_m!=100)) +
geom_raster(aes(x,y,fill=influenced_by_wells)) +
geom_sf(data=boundaries, aes()) +
ggtitle("Region of well influence")
grid_bounds_unconf <- boundaries %>% st_coordinates() %>% as_tibble() %>%
summarize(xmin=min(X),xmax=max(X),ymin=min(Y),ymax=max(Y))
# grid_bounds_unconf <- data.frame(xmin=265000,xmax=290000,ymin=5108000,ymax=5120000)
grid_pts_head_unconf <- with(grid_bounds_unconf,crossing(x=seq(xmin,xmax,length.out=150),y=seq(ymin,ymax,length.out=100)))
head_unconf_df <- grid_pts_head_unconf %>% bind_cols(head_m=heads_unconf)
ggplot(head_unconf_df %>% mutate(influenced_by_wells=head_m!=100)) +
geom_raster(aes(x,y,fill=influenced_by_wells)) +
geom_sf(data=boundaries, aes()) +
ggtitle("Region of well influence")
ggplot(head_unconf_df) +
geom_raster(aes(x,y,fill=head_m))  +
geom_contour(aes(x,y,z=head_m),bins=20,color="gray",linetype="dashed")  +
geom_sf(data=boundaries, aes()) +
# geom_sf(data=boundaries_utm, aes(), linetype="dashed",alpha=0.5,color="gray") +
geom_point(data=well_images %>% filter(level==0),aes(x0,y0)) +
# geom_sf(data=pts_utm, aes(size=abs(rate),shape=type)) +
coord_sf(xlim=c(grid_bounds_unconf$xmin,grid_bounds_unconf$xmax),ylim=c(grid_bounds_unconf$ymin,grid_bounds_unconf$ymax)) +
scale_shape_manual(values=c(1,16),limits=c(3,4))
wells
wells_game <- wells %>%
mutate(player=factor(well_group,levels=c("SIG","France","Commune"),labels=c("Player1","Player2","Recharge")),
well_type=factor(player,labels=c("pumping","recharge"))) %>%
group_by(player) %>%
mutate(rate=-1/n())
?factor
wells_game <- wells %>%
mutate(player=factor(well_group,levels=c("SIG","France","Commune"),labels=c("Player1","Player2","Recharge")),
well_type=factor(player,labels=c("pumping","pumping","recharge"))) %>%
group_by(player) %>%
mutate(rate=-1/n())
wells_game
wells_game$well_type
wells_game <- wells %>%
mutate(player=factor(well_group,levels=c("SIG","France","Commune"),labels=c("Player1","Player2","Recharge")),
well_type=factor(player,labels=c("pumping","pumping","recharge")),
well_sign=if_else(well_type=="pumping",-1,1)) %>%
group_by(player) %>%
mutate(rate=well_sign/n())
wells_game
wells_game <- wells %>%
mutate(player=factor(well_group,levels=c("SIG","France","Commune"),labels=c("S","F","Recharge")),
well_type=factor(player,labels=c("pumping","pumping","recharge")),
well_sign=if_else(well_type=="pumping",-1,1)) %>%
group_by(player) %>%
mutate(rate=well_sign/n())
wells_game
PHI_SF <- get_potential(loc=wells %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells %>% filter(player=="F"),
h0=h0,Ksat=Ksat,aquifer_type = "unconfined")
PHI_SF <- get_potential(loc=wells %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells %>% filter(player=="F"),
Ksat=Ksat,aquifer_type = "unconfined")
wells
wells_game
PHI_SF <- get_potential(loc=wells_game %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="F"),
Ksat=Ksat,aquifer_type = "unconfined")
wells_game <- wells %>%
mutate(player=factor(well_group,levels=c("SIG","France","Commune"),labels=c("S","F","Recharge")),
well_type=factor(player,labels=c("pumping","pumping","recharge")),
well_sign=if_else(well_type=="pumping",-1,1)) %>%
group_by(player) %>%
mutate(rate=well_sign/n()) %>% group_by()
PHI_SF <- get_potential(loc=wells_game %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="F"),
Ksat=Ksat,aquifer_type = "unconfined")
PHI_SF
PHI_SF <- get_potential(loc=wells_game %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="F"),
Ksat=Ksat,aquifer_type = "unconfined") %>%
mean()
PHI_SF
PHI_FS <- get_potential(loc=wells_game %>% filter(player=="F") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="S"),
Ksat=Ksat,aquifer_type = "unconfined") %>% mean()
PHI_SF
PHI_FS
get_potential(loc=wells_game %>% filter(player=="F") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="S"),
Ksat=Ksat,aquifer_type = "unconfined")
get_potential(loc=wells_game %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="F"),
Ksat=Ksat,aquifer_type = "unconfined")
PHI_FF <- get_potential(loc=wells_game %>% filter(player=="F") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="F"),
Ksat=Ksat,aquifer_type = "unconfined") %>% mean()
PHI_FF
PHI_SS
PHI_SS <- get_potential(loc=wells_game %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="S"),
Ksat=Ksat,aquifer_type = "unconfined") %>% mean()
PHI_SS
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_SF=PHI_FF) %>% gather(var,val)
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_SF=PHI_FF) %>% gather(var,val) %>% kable()
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_SF=PHI_FF) %>% gather(var,val) %>% kable::kable() %>%
kableExtra::kable_styling()
PHI_FF <- get_potential(loc=wells_game %>% filter(player=="F") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="F"),
Ksat=Ksat,aquifer_type = "unconfined") %>% mean()
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_SF=PHI_FF) %>% gather(var,val) %>% kable::kable() %>%
kableExtra::kable_styling()
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_SF=PHI_FF) %>% gather(var,val) %>% knitr::kable() %>%
kableExtra::kable_styling()
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_FF=PHI_FF,PHI_RS=PHI_RS,PHI_RF=PHI_RF) %>%
gather(PHI_ii,Value) %>% knitr::kable(format="html") %>%
kableExtra::kable_styling()
PHI_RS <- get_potential(loc=wells_game %>% filter(player=="S") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="Recharge"),
Ksat=Ksat,aquifer_type = "unconfined") %>% mean()
PHI_RF <- get_potential(loc=wells_game %>% filter(player=="F") %>% select(x=x0,y=y0),
wells=wells_game %>% filter(player=="Recharge"),
Ksat=Ksat,aquifer_type = "unconfined") %>% mean()
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_FF=PHI_FF,PHI_RS=PHI_RS,PHI_RF=PHI_RF) %>%
gather(PHI_ii,Value) %>% knitr::kable(format="html") %>%
kableExtra::kable_styling()
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_FF=PHI_FF,PHI_RS=PHI_RS,PHI_RF=PHI_RF) %>%
gather(PHI_ii,Value) %>% knitr::kable(format="HTML") %>%
kableExtra::kable_styling()
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_FF=PHI_FF,PHI_RS=PHI_RS,PHI_RF=PHI_RF) %>%
gather(PHI_ii,Value) %>% knitr::kable(format="html") %>%
kableExtra::kable_styling()
wells_game
wells_game <- wells %>%
mutate(player=factor(well_group,levels=c("SIG","France","Commune"),labels=c("S","F","Recharge")),
well_type=factor(player,labels=c("pumping","pumping","recharge")),
well_sign=if_else(well_type=="pumping",-1,1)) %>%
group_by(player) %>%
mutate(rate=well_sign/n()) %>% group_by()
well_game_images <- generate_image_wells(wells_game,boundaries,num_levels=3) %>%
filter(max_mirror_dist<roi)
well_game_images
ggplot() +
geom_sf(data=boundaries, aes()) +
geom_point(data=wells_game,aes(x0,y0,color=player))
ggplot() +
geom_sf(data=boundaries, aes()) +
geom_point(data=wells_game,aes(x0,y0,color=player))  +
scale_shape_manual(values=c(1,16),limits=c(3,4)) #+ scale_size_continuous(limits=c(3,4))
ggplot() +
geom_sf(data=boundaries, aes()) +
geom_point(data=wells_game,aes(x0,y0,color=player,shape=well_type))  +
scale_shape_manual(values=c(1,16),limits=c(3,4)) #+ scale_size_continuous(limits=c(3,4))
wells_game
ggplot() +
geom_sf(data=boundaries, aes()) +
geom_point(data=wells_game,aes(x0,y0,color=player,shape=well_type)) # +
ggplot() +
geom_sf(data=boundaries, aes()) +
geom_point(data=wells_game,aes(x0,y0,color=player,shape=well_type)) +
scale_shape_manual(values=c(1,16)) #+ scale_size_continuous(limits=c(3,4))
ggplot() +
geom_sf(data=boundaries, aes()) +
geom_point(data=wells_game,aes(x0,y0,color=player,shape=well_type),size=3) +
scale_shape_manual(values=c(1,16)) #+ scale_size_continuous(limits=c(3,4))
ggplot() +
geom_sf(data=boundaries, aes()) +
geom_point(data=wells_game,aes(x0,y0,color=player,shape=well_type),size=3,stroke=1) +
scale_shape_manual(values=c(1,16)) #+ scale_size_continuous(limits=c(3,4))
data.frame(PHI_SF=PHI_SF,PHI_FS=PHI_FS,PHI_SS=PHI_SS,PHI_FF=PHI_FF,PHI_RS=PHI_RS,PHI_RF=PHI_RF) %>%
gather(PHI_ii,Value) %>% knitr::kable(format="html") %>%
kableExtra::kable_styling()
24*365*3600
24*365*3600/1e6
data.frame(m=c(1,-1)) %>%
dplyr::left_join(get_quad_vertices_wide(bounds),by="bID") %>%
dplyr::mutate(x_unit=sqrt(1/(1+m^2)),
y_unit=-sign(m)*sqrt(m^2/(1+m^2)))
data.frame(m=c(1,-1)) %>%
dplyr::mutate(x_unit=sqrt(1/(1+m^2)),
y_unit=-sign(m)*sqrt(m^2/(1+m^2)))
data.frame(m=c(0.5,-0.5)) %>%
dplyr::mutate(x_unit=sqrt(1/(1+m^2)),
y_unit=-sign(m)*sqrt(m^2/(1+m^2)))
data.frame(m=c(0.5,-0.5)) %>%
dplyr::mutate(y_unit=sqrt(1/(1+m^2)),
x_unit=-sign(m)*sqrt(m^2/(1+m^2)))
data.frame(m=c(0.5,-0.5)) %>%
dplyr::mutate(x_unit=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit=sqrt(1/(1+m^2)))
data.frame(m=c(0,Inf)) %>%
dplyr::mutate(x_unit=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit=sqrt(1/(1+m^2)))
data.frame(m=c(0.9999,1e100)) %>%
dplyr::mutate(x_unit_norm=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit_norm=sqrt(1/(1+m^2)))
data.frame(m=c(0,1e100)) %>%
dplyr::mutate(x_unit_norm=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit_norm=sqrt(1/(1+m^2)))
data.frame(m=c(0,1e1000000)) %>%
dplyr::mutate(x_unit_norm=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit_norm=sqrt(1/(1+m^2)))
data.frame(m=c(0,1e10000)) %>%
dplyr::mutate(x_unit_norm=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit_norm=sqrt(1/(1+m^2)))
data.frame(m=c(0,1e1000)) %>%
dplyr::mutate(x_unit_norm=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit_norm=sqrt(1/(1+m^2)))
data.frame(m=c(0,1e100)) %>%
dplyr::mutate(x_unit_norm=-sign(m)*sqrt(m^2/(1+m^2)),
y_unit_norm=sqrt(1/(1+m^2)))
devtools::load_all(".")
# NOTE: THIS FUNCTION DOES NOT SEEM TO BE WORKING AS EXPECTED!
gg_bounds_behavior <- plot_bounds_behavior(wells,well_images,boundaries,h0=100,Ksat=0.00001,aquifer_type="unconfined")
devtools::load_all(".")
# NOTE: THIS FUNCTION DOES NOT SEEM TO BE WORKING AS EXPECTED!
gg_bounds_behavior <- plot_bounds_behavior(wells,well_images,boundaries,h0=100,Ksat=0.00001,aquifer_type="unconfined")
gridExtra::grid.arrange(gg_bounds_behavior$p_h,gg_bounds_behavior$p_f,nrow=1)
?get_radius_of_influence
1.9^2
sqrt(pi)
?prep_bounds
